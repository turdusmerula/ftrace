'use strict';

var ftraceAnalyser = angular.module('ftraceAnalyser');

ftraceAnalyser.controller('CallTreeCtrl', [ '$scope', 'jsonloader',
function($scope, jsonloader) {
	$scope.functions = jsonloader.functions ;
	$scope.threads = jsonloader.threads ;
	$scope.data = {} ;
	$scope.data.root = {"id":"7f84c9581700","scopes":[{"addr":"0x408530","calls":1,"time":9404166379,"scopes":[{"addr":"0x408240","calls":1,"time":9404007832,"scopes":[{"addr":"0x407750","calls":1,"time":9403363688,"scopes":[{"addr":"0x407460","calls":1,"time":1474456,"scopes":[{"addr":"0x4073f0","calls":1,"time":966924,"scopes":[{"addr":"0x406d00","calls":1,"time":470197,"scopes":[{"addr":"0x406cd0","calls":1,"time":700}]}]}]},{"addr":"0x4069c0","calls":1,"time":644},{"addr":"0x406d50","calls":1,"time":9392255656,"scopes":[{"addr":"0x406980","calls":1,"time":9391889959,"scopes":[{"addr":"0x406940","calls":5,"time":9387290773,"scopes":[{"addr":"0x406900","calls":10,"time":6355425660,"scopes":[{"addr":"0x4068c0","calls":10,"time":5772200959,"scopes":[{"addr":"0x406890","calls":1000,"time":718969}]},{"addr":"0x406890","calls":100,"time":72420}]},{"addr":"0x4068c0","calls":5,"time":2897838694,"scopes":[{"addr":"0x406890","calls":500,"time":331787}]},{"addr":"0x406890","calls":5,"time":2995}]}]}]}]}]}]},{"addr":"0x40a710","calls":1,"time":66878535,"scopes":[{"addr":"0x4072d0","calls":1,"time":1262224,"scopes":[{"addr":"0x406db0","calls":1,"time":738029,"scopes":[{"addr":"0x406d80","calls":1,"time":632}]}]},{"addr":"0x406c80","calls":1,"time":755586,"scopes":[{"addr":"0x406c50","calls":1,"time":585}]},{"addr":"0x409f60","calls":1,"time":63337241,"scopes":[{"addr":"0x409ca0","calls":1,"time":62701385,"scopes":[{"addr":"0x409540","calls":1,"time":61881315,"scopes":[{"addr":"0x40a490","calls":1,"time":61218394,"scopes":[{"addr":"0x413940","calls":1,"time":1548994,"scopes":[{"addr":"0x412d60","calls":1,"time":460300,"scopes":[{"addr":"0x412800","calls":1,"time":254062,"scopes":[{"addr":"0x412150","calls":1,"time":974}]}]}]}]}]}]}]}]},{"addr":"0x4088c0","calls":1,"time":89811340,"scopes":[{"addr":"0x406c80","calls":1,"time":1148275,"scopes":[{"addr":"0x406c50","calls":1,"time":900}]},{"addr":"0x407140","calls":1,"time":824541,"scopes":[{"addr":"0x406b00","calls":1,"time":865}]},{"addr":"0x408660","calls":1,"time":74132185,"scopes":[{"addr":"0x408430","calls":1,"time":73570300,"scopes":[{"addr":"0x408160","calls":1,"time":72901807,"scopes":[{"addr":"0x407bd0","calls":1,"time":72143034,"scopes":[{"addr":"0x407a60","calls":1,"time":70366801,"scopes":[{"addr":"0x4079f0","calls":1,"time":2386915,"scopes":[{"addr":"0x4070f0","calls":1,"time":1979165,"scopes":[{"addr":"0x406e30","calls":1,"time":547}]}]}]},{"addr":"0x40f7e0","calls":1,"time":691}]}]}]}]},{"addr":"0x4071e0","calls":1,"time":907591,"scopes":[{"addr":"0x407030","calls":1,"time":1662}]},{"addr":"0x407190","calls":1,"time":773499,"scopes":[{"addr":"0x406e60","calls":1,"time":665}]}]}],"calls":[{"addr":"0x408530","calls":1,"time":9404166379,"name":""},{"addr":"0x408240","calls":1,"time":9404007832,"name":""},{"addr":"0x407750","calls":1,"time":9403363688,"name":""},{"addr":"0x407460","calls":1,"time":1474456,"name":""},{"addr":"0x4073f0","calls":1,"time":966924,"name":""},{"addr":"0x406d00","calls":1,"time":470197,"name":""},{"addr":"0x406cd0","calls":1,"time":700,"name":""},{"addr":"0x4069c0","calls":1,"time":644,"name":"main+0x106"},{"addr":"0x406d50","calls":1,"time":9392255656,"name":""},{"addr":"0x406980","calls":1,"time":9391889959,"name":"func5"},{"addr":"0x406940","calls":5,"time":9387290773,"name":"func4"},{"addr":"0x406900","calls":10,"time":6355425660,"name":"func3"},{"addr":"0x4068c0","calls":15,"time":8670039653,"name":"func2"},{"addr":"0x406890","calls":1605,"time":1126171,"name":"func1"},{"addr":"0x40a710","calls":1,"time":66878535,"name":""},{"addr":"0x4072d0","calls":1,"time":1262224,"name":""},{"addr":"0x406db0","calls":1,"time":738029,"name":""},{"addr":"0x406d80","calls":1,"time":632,"name":""},{"addr":"0x406c80","calls":2,"time":1903861,"name":""},{"addr":"0x406c50","calls":2,"time":1485,"name":""},{"addr":"0x409f60","calls":1,"time":63337241,"name":""},{"addr":"0x409ca0","calls":1,"time":62701385,"name":""},{"addr":"0x409540","calls":1,"time":61881315,"name":""},{"addr":"0x40a490","calls":1,"time":61218394,"name":""},{"addr":"0x413940","calls":1,"time":1548994,"name":""},{"addr":"0x412d60","calls":1,"time":460300,"name":""},{"addr":"0x412800","calls":1,"time":254062,"name":""},{"addr":"0x412150","calls":1,"time":974,"name":""},{"addr":"0x4088c0","calls":1,"time":89811340,"name":""},{"addr":"0x407140","calls":1,"time":824541,"name":""},{"addr":"0x406b00","calls":1,"time":865,"name":""},{"addr":"0x408660","calls":1,"time":74132185,"name":""},{"addr":"0x408430","calls":1,"time":73570300,"name":""},{"addr":"0x408160","calls":1,"time":72901807,"name":""},{"addr":"0x407bd0","calls":1,"time":72143034,"name":""},{"addr":"0x407a60","calls":1,"time":70366801,"name":""},{"addr":"0x4079f0","calls":1,"time":2386915,"name":""},{"addr":"0x4070f0","calls":1,"time":1979165,"name":""},{"addr":"0x406e30","calls":1,"time":547,"name":""},{"addr":"0x40f7e0","calls":1,"time":691,"name":""},{"addr":"0x4071e0","calls":1,"time":907591,"name":""},{"addr":"0x407030","calls":1,"time":1662,"name":""},{"addr":"0x407190","calls":1,"time":773499,"name":""},{"addr":"0x406e60","calls":1,"time":665,"name":""}]} ;
//	$scope.thread = {"id":"7f84c9581700","scopes":[{"addr":"0x408530","calls":1,"time":9404166379,"scopes":[{"addr":"0x408240","calls":1,"time":9404007832,"scopes":[{"addr":"0x407750","calls":1,"time":9403363688,"scopes":[{"addr":"0x407460","calls":1,"time":1474456,"scopes":[{"addr":"0x4073f0","calls":1,"time":966924,"scopes":[{"addr":"0x406d00","calls":1,"time":470197,"scopes":[{"addr":"0x406cd0","calls":1,"time":700}]}]}]},{"addr":"0x4069c0","calls":1,"time":644},{"addr":"0x406d50","calls":1,"time":9392255656,"scopes":[{"addr":"0x406980","calls":1,"time":9391889959,"scopes":[{"addr":"0x406940","calls":5,"time":9387290773,"scopes":[{"addr":"0x406900","calls":10,"time":6355425660,"scopes":[{"addr":"0x4068c0","calls":10,"time":5772200959,"scopes":[{"addr":"0x406890","calls":1000,"time":718969}]},{"addr":"0x406890","calls":100,"time":72420}]},{"addr":"0x4068c0","calls":5,"time":2897838694,"scopes":[{"addr":"0x406890","calls":500,"time":331787}]},{"addr":"0x406890","calls":5,"time":2995}]}]}]}]}]}]},{"addr":"0x40a710","calls":1,"time":66878535,"scopes":[{"addr":"0x4072d0","calls":1,"time":1262224,"scopes":[{"addr":"0x406db0","calls":1,"time":738029,"scopes":[{"addr":"0x406d80","calls":1,"time":632}]}]},{"addr":"0x406c80","calls":1,"time":755586,"scopes":[{"addr":"0x406c50","calls":1,"time":585}]},{"addr":"0x409f60","calls":1,"time":63337241,"scopes":[{"addr":"0x409ca0","calls":1,"time":62701385,"scopes":[{"addr":"0x409540","calls":1,"time":61881315,"scopes":[{"addr":"0x40a490","calls":1,"time":61218394,"scopes":[{"addr":"0x413940","calls":1,"time":1548994,"scopes":[{"addr":"0x412d60","calls":1,"time":460300,"scopes":[{"addr":"0x412800","calls":1,"time":254062,"scopes":[{"addr":"0x412150","calls":1,"time":974}]}]}]}]}]}]}]}]},{"addr":"0x4088c0","calls":1,"time":89811340,"scopes":[{"addr":"0x406c80","calls":1,"time":1148275,"scopes":[{"addr":"0x406c50","calls":1,"time":900}]},{"addr":"0x407140","calls":1,"time":824541,"scopes":[{"addr":"0x406b00","calls":1,"time":865}]},{"addr":"0x408660","calls":1,"time":74132185,"scopes":[{"addr":"0x408430","calls":1,"time":73570300,"scopes":[{"addr":"0x408160","calls":1,"time":72901807,"scopes":[{"addr":"0x407bd0","calls":1,"time":72143034,"scopes":[{"addr":"0x407a60","calls":1,"time":70366801,"scopes":[{"addr":"0x4079f0","calls":1,"time":2386915,"scopes":[{"addr":"0x4070f0","calls":1,"time":1979165,"scopes":[{"addr":"0x406e30","calls":1,"time":547}]}]}]},{"addr":"0x40f7e0","calls":1,"time":691}]}]}]}]},{"addr":"0x4071e0","calls":1,"time":907591,"scopes":[{"addr":"0x407030","calls":1,"time":1662}]},{"addr":"0x407190","calls":1,"time":773499,"scopes":[{"addr":"0x406e60","calls":1,"time":665}]}]}],"calls":[{"addr":"0x408530","calls":1,"time":9404166379,"name":""},{"addr":"0x408240","calls":1,"time":9404007832,"name":""},{"addr":"0x407750","calls":1,"time":9403363688,"name":""},{"addr":"0x407460","calls":1,"time":1474456,"name":""},{"addr":"0x4073f0","calls":1,"time":966924,"name":""},{"addr":"0x406d00","calls":1,"time":470197,"name":""},{"addr":"0x406cd0","calls":1,"time":700,"name":""},{"addr":"0x4069c0","calls":1,"time":644,"name":"main+0x106"},{"addr":"0x406d50","calls":1,"time":9392255656,"name":""},{"addr":"0x406980","calls":1,"time":9391889959,"name":"func5"},{"addr":"0x406940","calls":5,"time":9387290773,"name":"func4"},{"addr":"0x406900","calls":10,"time":6355425660,"name":"func3"},{"addr":"0x4068c0","calls":15,"time":8670039653,"name":"func2"},{"addr":"0x406890","calls":1605,"time":1126171,"name":"func1"},{"addr":"0x40a710","calls":1,"time":66878535,"name":""},{"addr":"0x4072d0","calls":1,"time":1262224,"name":""},{"addr":"0x406db0","calls":1,"time":738029,"name":""},{"addr":"0x406d80","calls":1,"time":632,"name":""},{"addr":"0x406c80","calls":2,"time":1903861,"name":""},{"addr":"0x406c50","calls":2,"time":1485,"name":""},{"addr":"0x409f60","calls":1,"time":63337241,"name":""},{"addr":"0x409ca0","calls":1,"time":62701385,"name":""},{"addr":"0x409540","calls":1,"time":61881315,"name":""},{"addr":"0x40a490","calls":1,"time":61218394,"name":""},{"addr":"0x413940","calls":1,"time":1548994,"name":""},{"addr":"0x412d60","calls":1,"time":460300,"name":""},{"addr":"0x412800","calls":1,"time":254062,"name":""},{"addr":"0x412150","calls":1,"time":974,"name":""},{"addr":"0x4088c0","calls":1,"time":89811340,"name":""},{"addr":"0x407140","calls":1,"time":824541,"name":""},{"addr":"0x406b00","calls":1,"time":865,"name":""},{"addr":"0x408660","calls":1,"time":74132185,"name":""},{"addr":"0x408430","calls":1,"time":73570300,"name":""},{"addr":"0x408160","calls":1,"time":72901807,"name":""},{"addr":"0x407bd0","calls":1,"time":72143034,"name":""},{"addr":"0x407a60","calls":1,"time":70366801,"name":""},{"addr":"0x4079f0","calls":1,"time":2386915,"name":""},{"addr":"0x4070f0","calls":1,"time":1979165,"name":""},{"addr":"0x406e30","calls":1,"time":547,"name":""},{"addr":"0x40f7e0","calls":1,"time":691,"name":""},{"addr":"0x4071e0","calls":1,"time":907591,"name":""},{"addr":"0x407030","calls":1,"time":1662,"name":""},{"addr":"0x407190","calls":1,"time":773499,"name":""},{"addr":"0x406e60","calls":1,"time":665,"name":""}]} ;
//	$scope.scopes = {} ;
	$scope.allThreads = jsonloader ;
	
	$scope.getThread = function() {
		return $scope.thread ;
	};
	
	$scope.$on('json-loaded', function() {
		$log.debug("refresh functions") ;
		$scope.functions = jsonloader.functions ;
		$scope.threads = jsonloader.threads ;
		$scope.data.root = jsonloader.threads[0] ;
		$scope.calls = jsonloader.calls ;
        $scope.$apply();
	}) ;

	
    $scope.select = function(item) {
    	$scope.data.root = item ;
        $scope.$apply();
    	$log.log('Selected: ', item);
    };
		
}]);
